{"version":3,"sources":["webpack:///path---posts-2019-02-23-jenkins-extended-e-mail-notification-plugin에서-비어있는-환경변수-처리-f2434fb1845349173a77.js","webpack:///./.cache/json/posts-2019-02-23-jenkins-extended-e-mail-notification-plugin에서-비어있는-환경변수-처리.json"],"names":["webpackJsonp","408","module","exports","data","site","siteMetadata","title","subtitle","author","name","github","disqusShortname","url","markdownRemark","id","html","fields","slug","tagSlugs","frontmatter","tags","date","description","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,cAAAC,SAAA,gCAAAC,QAA2EC,KAAA,QAAAC,OAAA,SAAgCC,gBAAA,QAAAC,IAAA,4BAA4DC,gBAAmBC,GAAA,4JAAAC,KAAA,4obAA28aC,QAA+qBC,KAAA,iFAAAC,UAAA,mCAAsIC,aAAgBb,MAAA,6DAAAc,MAAA,oBAAAC,KAAA,2BAAAC,YAAA,sEAAsNC,aAAgBN,KAAA","file":"path---posts-2019-02-23-jenkins-extended-e-mail-notification-plugin에서-비어있는-환경변수-처리-f2434fb1845349173a77.js","sourcesContent":["webpackJsonp([274958555436247],{\n\n/***/ 408:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"kujyp 개발블로그\",\"subtitle\":\"ML DevOps, Python, Docker ...\",\"author\":{\"name\":\"kujyp\",\"github\":\"kujyp\"},\"disqusShortname\":\"kujyp\",\"url\":\"https://kujyp.github.io\"}},\"markdownRemark\":{\"id\":\"/home/circleci/app/src/pages/articles/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h3>TL;DR</h3>\\n<p>Jenkins Extended E-mail Notification plugin을 사용하여 email 알림을 보낼때 비어있는 환경변수를 처리한다. </p>\\n<h4>Email-ext plugin</h4>\\n<p><a href=\\\"https://wiki.jenkins.io/display/JENKINS/Email-ext+plugin\\\">Email-ext plugin</a> 은 Jenkins에서 작업 완료 알림을 이메일로 받아 볼 수 있도록 해준다.</p>\\n<p>나는 사내 Repository에서 Jenkins pipeline 중 post block을 아래의 내용으로 채우고있다.<br/>\\ntag나 Pull Request로 유발된 작업이거나, master branch 인 경우, 작업이 끝났을때 알림 이메일을 보낸다는 내용이다.<br/> </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-groovy\\\"><code class=\\\"language-groovy\\\">post <span class=\\\"token punctuation\\\">{</span>\\n    always <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// recipientProviders document: https://jenkins.io/doc/pipeline/steps/email-ext/</span>\\n        script <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>env<span class=\\\"token operator\\\">.</span>BRANCH_NAME <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">\\\"master\\\"</span>\\n                    <span class=\\\"token operator\\\">||</span> env<span class=\\\"token operator\\\">.</span>BRANCH_NAME<span class=\\\"token operator\\\">.</span><span class=\\\"token function\\\">startsWith</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"PR\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n                    <span class=\\\"token operator\\\">||</span> env<span class=\\\"token operator\\\">.</span>TAG_NAME<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n                <span class=\\\"token keyword\\\">def</span> committerEmail <span class=\\\"token operator\\\">=</span> sh <span class=\\\"token punctuation\\\">(</span>\\n                    script<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'git --no-pager show -s --format=\\\\'%ae\\\\''</span><span class=\\\"token punctuation\\\">,</span>\\n                    returnStdout<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">true</span>\\n                <span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">.</span><span class=\\\"token function\\\">trim</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\n                <span class=\\\"token function\\\">emailext</span><span class=\\\"token punctuation\\\">(</span>\\n                  subject<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'$DEFAULT_SUBJECT'</span><span class=\\\"token punctuation\\\">,</span>\\n                  body<span class=\\\"token punctuation\\\">:</span> '<span class=\\\"token punctuation\\\">$</span>DEFAULT_CONTENT\\\\n\\\\\\n\\\\n\\\\\\nThis email triggered by <span class=\\\"token punctuation\\\">(</span>PR<span class=\\\"token punctuation\\\">,</span> tag<span class=\\\"token punctuation\\\">,</span> master branch<span class=\\\"token punctuation\\\">)</span> only<span class=\\\"token operator\\\">.</span>\\\\n\\\\\\n'<span class=\\\"token punctuation\\\">,</span>\\n                  to<span class=\\\"token punctuation\\\">:</span> committerEmail<span class=\\\"token punctuation\\\">,</span>\\n                  recipientProviders<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'DevelopersRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'RequesterRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CulpritsRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span>\\n                  <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                <span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n\\n        <span class=\\\"token function\\\">deleteDir</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n        echo <span class=\\\"token string\\\">'done'</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">...</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Email-ext plugin을 사용하면, <code class=\\\"language-text\\\">Default Subject</code>(제목)이 <code class=\\\"language-text\\\">$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!</code> 로 세팅되어있다.<br/>\\n<code class=\\\"language-text\\\">Manage Jenkins &gt; Configure System &gt; Extended E-mail Notification &gt; Defalt Subject, Default Content</code> 에서 변경이 가능한데,<br/>\\nPull Request를 하는경우 어떤 PR에서 날라온 결과인지 구분하기위해 제목에 PR이름을 추가했다.<br/>\\nJenkins에서는 이를 <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 로 제공한다.<br/></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token variable\\\">$PROJECT_NAME</span> <span class=\\\"token variable\\\">$CHANGE_TITLE</span> - Build <span class=\\\"token comment\\\"># $BUILD_NUMBER - $BUILD_STATUS!</span></code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-65191.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 45.10978043912176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz5WSC27EIAxEc//b9AC9TpvdNOQD4Q/TMVmkqoqi1tKTDYFhbGWY5xnCcRwVjFprDCG8p5TeSimj7DFXgjskYsoYvPcQKNQFy7qukzFm5EEvh3POleCOZVmwbhoDnUEpBedccyK6MUbQYXuZuYnJ+or+TXQ2bTBorUFHIlhF6DR5xo9W/9SyCwnDtm1ge+ghDvvL/8W6cLYsLkWoc3cp3bTvQzwFhW6bvbW1uJZsX7UxGoYPy1hKOcXLi1Zzz3k63PcdgmxKpFzw8VDkC59Phce0sJ4xMk9qh7GRsyqwF2jLGeJXpFyxagdrLR1aZoeDNf9NuqgobSy4xLiCb2xJwV+0W0wnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"before_setting.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-c83f1.png\\\"\\n        srcset=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-569e3.png 240w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-93400.png 480w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-c83f1.png 960w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-23e13.png 1440w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-65191.png 1503w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>그런데 이것이 일반 브랜치(master, tag로 trigger되는경우)에서는 PR제목이 존재하지않아서, <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 에 넣을 값이 존재하지 않는 경우가 생긴다.<br/>\\n이 경우 Email-ext plugin은 이메일에 <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 문자를 그대로 발송한다.<br/>\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-69124.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 38.17204301075269%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABTElEQVQoz11S6U7DMAzO+z8MEtJ4BR6A8Y9Jg7Zq0yM90ittYhs72sqYpU9OHB+f7ajL5YJVVVGSJJhlGYr+vl4xTRMsCo0/WYl5aTBLUxyGgViQheKBbprv8zyTtZZU13XUNA2WZUml1lTXNRnTkh16suNIWyACOgQBMCZ4xl1U27Zc2XISg13XwsdXDu/nHIrKQN93YEwDzq0gPCgyums62D1C5XnOQYYTdp+DnV96697svJ8mhnP+NE3utG3+tW1BM3HSJWBdBxIS0p33/l9iJe1KQnbYxnGc+W1hzM/wgcLOsftOKDqEEPEs6j7lvzlgdASAG8It2DN29H4ngdiE3bZtERIvd8VB2Pc98VKQH3CaJtRao8yWFxRRFEW0yW+oqjousOHlsW/cLHcWC4hWklkqLMtytCFnsa3remiBc45b3g9WjyLdyPsvrCRplJ3ogLsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"prev_example.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-c83f1.png\\\"\\n        srcset=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-569e3.png 240w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-93400.png 480w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-c83f1.png 960w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-23e13.png 1440w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-69124.png 1860w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>이를 개선하려고 찾아보니 환경변수를 <code class=\\\"language-text\\\">${ENV, var=&quot;VARIABLE_NAME&quot;}</code>로 가져올수 있어서, 이 포맷를 적용했다.<br/>\\nShell 환경변수는 가져올때 해당변수가 할당이 안되어있는경우 공백(\\\"\\\")을 제공하므로 위의 문제를 해결할 수 있다.<br/><br>\\n<a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-e5628.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 46.33663366336634%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVQoz42SfW6EIBDFvf+leoYeoP3T3SiCiKB8+Tozsq3NJttO8nPAwOPNQGethVIK67oeFOBPSuk95/xWax1BQfkg8AqOmDK6GCO2bRMh/snZOWeJkRZGXlxKOQi8YlkWaGPR7fsOYwy89+KEdckh+KCrWC75mZxFjDPvnzQJhhBEkFweLHJc4lLqv0r2W0RHvRO7j2CHZxkZf5V5pdYCt26nw3mev09hwSwl/iyWeW7QOFFOdAEpN2RcTofcw9Y/nDd6YDAB/ejw2Tt83Dx65THoFXflcCOmJcKGitkXWEIyze9mR8di/HS4sQ+HPJ+mCaPSgtZG+jzTf66GTbQLI6rA88AO22v51UPePAwDbTbglgQ69CrS3usTXP4XBenAPwcWt3YAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"env_setting.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-c83f1.png\\\"\\n        srcset=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-569e3.png 240w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-93400.png 480w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-c83f1.png 960w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-23e13.png 1440w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-10d8f.png 1920w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-6bb82.png 2880w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-e5628.png 3030w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<ul>\\n<li>아래는 참고했었던, 문서 위치.<br/>\\n<code class=\\\"language-text\\\">Manage Jenkins &gt; Configure System &gt; Extended E-mail Notification</code> 섹션에서, <code class=\\\"language-text\\\">Content Reference</code> 오른쪽의 물음표(?)를 클릭하면 볼수있다.<br>\\n<img src=\\\"/reference_gif-1d30a3e49ff5bbb0708b784939ffd1e3.gif\\\" alt=\\\"reference_gif.gif\\\"></li>\\n<li>${ENV, var=“VARIABLENAME”}\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-881e0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.948191593352883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAfElEQVQI103MsQrCMAAA0f7/9ygODgoWER1ColK0SU3a0iZBUan7GamIwxtuuez+eJILw2yjmeQFubQcdI8qO/aJPLUUpqOqA8Z5yg/r0S78GTvEK9lrGNgqzXRdMt9VLETNSjYj1bIUjqPpOduYxh7XRi5NSOJX+HWMN94YYY9RuomMeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"reference.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-c83f1.png\\\"\\n        srcset=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-569e3.png 240w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-93400.png 480w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-c83f1.png 960w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-23e13.png 1440w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-10d8f.png 1920w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-881e0.png 2046w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </li>\\n</ul>\",\"fields\":{\"slug\":\"/posts/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리\",\"tagSlugs\":[\"/tags/jenkins/\",\"/tags/devops/\"]},\"frontmatter\":{\"title\":\"Jenkins Extended E-mail Notification plugin에서 비어있는 환경변수 처리\",\"tags\":[\"jenkins\",\"devops\"],\"date\":\"2019-02-23T01:49:00.000Z\",\"description\":\"Jenkins Extended E-mail Notification plugin을 사용하여 email 알림을 보낸다.\"}}},\"pathContext\":{\"slug\":\"/posts/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---posts-2019-02-23-jenkins-extended-e-mail-notification-plugin에서-비어있는-환경변수-처리-f2434fb1845349173a77.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"kujyp 개발블로그\",\"subtitle\":\"ML DevOps, Python, Docker ...\",\"author\":{\"name\":\"kujyp\",\"github\":\"kujyp\"},\"disqusShortname\":\"kujyp\",\"url\":\"https://kujyp.github.io\"}},\"markdownRemark\":{\"id\":\"/home/circleci/app/src/pages/articles/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h3>TL;DR</h3>\\n<p>Jenkins Extended E-mail Notification plugin을 사용하여 email 알림을 보낼때 비어있는 환경변수를 처리한다. </p>\\n<h4>Email-ext plugin</h4>\\n<p><a href=\\\"https://wiki.jenkins.io/display/JENKINS/Email-ext+plugin\\\">Email-ext plugin</a> 은 Jenkins에서 작업 완료 알림을 이메일로 받아 볼 수 있도록 해준다.</p>\\n<p>나는 사내 Repository에서 Jenkins pipeline 중 post block을 아래의 내용으로 채우고있다.<br/>\\ntag나 Pull Request로 유발된 작업이거나, master branch 인 경우, 작업이 끝났을때 알림 이메일을 보낸다는 내용이다.<br/> </p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-groovy\\\"><code class=\\\"language-groovy\\\">post <span class=\\\"token punctuation\\\">{</span>\\n    always <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// recipientProviders document: https://jenkins.io/doc/pipeline/steps/email-ext/</span>\\n        script <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>env<span class=\\\"token operator\\\">.</span>BRANCH_NAME <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">\\\"master\\\"</span>\\n                    <span class=\\\"token operator\\\">||</span> env<span class=\\\"token operator\\\">.</span>BRANCH_NAME<span class=\\\"token operator\\\">.</span><span class=\\\"token function\\\">startsWith</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"PR\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n                    <span class=\\\"token operator\\\">||</span> env<span class=\\\"token operator\\\">.</span>TAG_NAME<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n                <span class=\\\"token keyword\\\">def</span> committerEmail <span class=\\\"token operator\\\">=</span> sh <span class=\\\"token punctuation\\\">(</span>\\n                    script<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'git --no-pager show -s --format=\\\\'%ae\\\\''</span><span class=\\\"token punctuation\\\">,</span>\\n                    returnStdout<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">true</span>\\n                <span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">.</span><span class=\\\"token function\\\">trim</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\n                <span class=\\\"token function\\\">emailext</span><span class=\\\"token punctuation\\\">(</span>\\n                  subject<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'$DEFAULT_SUBJECT'</span><span class=\\\"token punctuation\\\">,</span>\\n                  body<span class=\\\"token punctuation\\\">:</span> '<span class=\\\"token punctuation\\\">$</span>DEFAULT_CONTENT\\\\n\\\\\\n\\\\n\\\\\\nThis email triggered by <span class=\\\"token punctuation\\\">(</span>PR<span class=\\\"token punctuation\\\">,</span> tag<span class=\\\"token punctuation\\\">,</span> master branch<span class=\\\"token punctuation\\\">)</span> only<span class=\\\"token operator\\\">.</span>\\\\n\\\\\\n'<span class=\\\"token punctuation\\\">,</span>\\n                  to<span class=\\\"token punctuation\\\">:</span> committerEmail<span class=\\\"token punctuation\\\">,</span>\\n                  recipientProviders<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'DevelopersRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'RequesterRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">$</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CulpritsRecipientProvider'</span><span class=\\\"token punctuation\\\">]</span>\\n                  <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                <span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n\\n        <span class=\\\"token function\\\">deleteDir</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n        echo <span class=\\\"token string\\\">'done'</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">...</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Email-ext plugin을 사용하면, <code class=\\\"language-text\\\">Default Subject</code>(제목)이 <code class=\\\"language-text\\\">$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!</code> 로 세팅되어있다.<br/>\\n<code class=\\\"language-text\\\">Manage Jenkins &gt; Configure System &gt; Extended E-mail Notification &gt; Defalt Subject, Default Content</code> 에서 변경이 가능한데,<br/>\\nPull Request를 하는경우 어떤 PR에서 날라온 결과인지 구분하기위해 제목에 PR이름을 추가했다.<br/>\\nJenkins에서는 이를 <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 로 제공한다.<br/></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token variable\\\">$PROJECT_NAME</span> <span class=\\\"token variable\\\">$CHANGE_TITLE</span> - Build <span class=\\\"token comment\\\"># $BUILD_NUMBER - $BUILD_STATUS!</span></code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-65191.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 45.10978043912176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz5WSC27EIAxEc//b9AC9TpvdNOQD4Q/TMVmkqoqi1tKTDYFhbGWY5xnCcRwVjFprDCG8p5TeSimj7DFXgjskYsoYvPcQKNQFy7qukzFm5EEvh3POleCOZVmwbhoDnUEpBedccyK6MUbQYXuZuYnJ+or+TXQ2bTBorUFHIlhF6DR5xo9W/9SyCwnDtm1ge+ghDvvL/8W6cLYsLkWoc3cp3bTvQzwFhW6bvbW1uJZsX7UxGoYPy1hKOcXLi1Zzz3k63PcdgmxKpFzw8VDkC59Phce0sJ4xMk9qh7GRsyqwF2jLGeJXpFyxagdrLR1aZoeDNf9NuqgobSy4xLiCb2xJwV+0W0wnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"before_setting.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-c83f1.png\\\"\\n        srcset=\\\"/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-569e3.png 240w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-93400.png 480w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-c83f1.png 960w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-23e13.png 1440w,\\n/static/before_setting-058c600d96fc8f1c64594d4a91b7b75e-65191.png 1503w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>그런데 이것이 일반 브랜치(master, tag로 trigger되는경우)에서는 PR제목이 존재하지않아서, <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 에 넣을 값이 존재하지 않는 경우가 생긴다.<br/>\\n이 경우 Email-ext plugin은 이메일에 <code class=\\\"language-text\\\">$CHANGE_TITLE</code> 문자를 그대로 발송한다.<br/>\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-69124.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 38.17204301075269%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABTElEQVQoz11S6U7DMAzO+z8MEtJ4BR6A8Y9Jg7Zq0yM90ittYhs72sqYpU9OHB+f7ajL5YJVVVGSJJhlGYr+vl4xTRMsCo0/WYl5aTBLUxyGgViQheKBbprv8zyTtZZU13XUNA2WZUml1lTXNRnTkh16suNIWyACOgQBMCZ4xl1U27Zc2XISg13XwsdXDu/nHIrKQN93YEwDzq0gPCgyums62D1C5XnOQYYTdp+DnV96697svJ8mhnP+NE3utG3+tW1BM3HSJWBdBxIS0p33/l9iJe1KQnbYxnGc+W1hzM/wgcLOsftOKDqEEPEs6j7lvzlgdASAG8It2DN29H4ngdiE3bZtERIvd8VB2Pc98VKQH3CaJtRao8yWFxRRFEW0yW+oqjousOHlsW/cLHcWC4hWklkqLMtytCFnsa3remiBc45b3g9WjyLdyPsvrCRplJ3ogLsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"prev_example.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-c83f1.png\\\"\\n        srcset=\\\"/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-569e3.png 240w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-93400.png 480w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-c83f1.png 960w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-23e13.png 1440w,\\n/static/prev_example-86d7ec92fddc4ac6612bde232b6fee78-69124.png 1860w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>이를 개선하려고 찾아보니 환경변수를 <code class=\\\"language-text\\\">${ENV, var=&quot;VARIABLE_NAME&quot;}</code>로 가져올수 있어서, 이 포맷를 적용했다.<br/>\\nShell 환경변수는 가져올때 해당변수가 할당이 안되어있는경우 공백(\\\"\\\")을 제공하므로 위의 문제를 해결할 수 있다.<br/><br>\\n<a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-e5628.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 46.33663366336634%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVQoz42SfW6EIBDFvf+leoYeoP3T3SiCiKB8+Tozsq3NJttO8nPAwOPNQGethVIK67oeFOBPSuk95/xWax1BQfkg8AqOmDK6GCO2bRMh/snZOWeJkRZGXlxKOQi8YlkWaGPR7fsOYwy89+KEdckh+KCrWC75mZxFjDPvnzQJhhBEkFweLHJc4lLqv0r2W0RHvRO7j2CHZxkZf5V5pdYCt26nw3mev09hwSwl/iyWeW7QOFFOdAEpN2RcTofcw9Y/nDd6YDAB/ejw2Tt83Dx65THoFXflcCOmJcKGitkXWEIyze9mR8di/HS4sQ+HPJ+mCaPSgtZG+jzTf66GTbQLI6rA88AO22v51UPePAwDbTbglgQ69CrS3usTXP4XBenAPwcWt3YAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"env_setting.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-c83f1.png\\\"\\n        srcset=\\\"/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-569e3.png 240w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-93400.png 480w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-c83f1.png 960w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-23e13.png 1440w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-10d8f.png 1920w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-6bb82.png 2880w,\\n/static/env_setting-e9e36831e8d4bac1fb06bb3d89ce7a14-e5628.png 3030w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<ul>\\n<li>아래는 참고했었던, 문서 위치.<br/>\\n<code class=\\\"language-text\\\">Manage Jenkins &gt; Configure System &gt; Extended E-mail Notification</code> 섹션에서, <code class=\\\"language-text\\\">Content Reference</code> 오른쪽의 물음표(?)를 클릭하면 볼수있다.<br>\\n<img src=\\\"/reference_gif-1d30a3e49ff5bbb0708b784939ffd1e3.gif\\\" alt=\\\"reference_gif.gif\\\"></li>\\n<li>${ENV, var=“VARIABLENAME”}\\n\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-881e0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 10.948191593352883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAfElEQVQI103MsQrCMAAA0f7/9ygODgoWER1ColK0SU3a0iZBUan7GamIwxtuuez+eJILw2yjmeQFubQcdI8qO/aJPLUUpqOqA8Z5yg/r0S78GTvEK9lrGNgqzXRdMt9VLETNSjYj1bIUjqPpOduYxh7XRi5NSOJX+HWMN94YYY9RuomMeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"reference.png\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-c83f1.png\\\"\\n        srcset=\\\"/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-569e3.png 240w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-93400.png 480w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-c83f1.png 960w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-23e13.png 1440w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-10d8f.png 1920w,\\n/static/reference-94bfa5cadcd94caa2a6d2ad08b8f2ce4-881e0.png 2046w\\\"\\n        sizes=\\\"(max-width: 960px) 100vw, 960px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </li>\\n</ul>\",\"fields\":{\"slug\":\"/posts/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리\",\"tagSlugs\":[\"/tags/jenkins/\",\"/tags/devops/\"]},\"frontmatter\":{\"title\":\"Jenkins Extended E-mail Notification plugin에서 비어있는 환경변수 처리\",\"tags\":[\"jenkins\",\"devops\"],\"date\":\"2019-02-23T01:49:00.000Z\",\"description\":\"Jenkins Extended E-mail Notification plugin을 사용하여 email 알림을 보낸다.\"}}},\"pathContext\":{\"slug\":\"/posts/2019-02-23---Jenkins-Extended-E-mail-Notification-plugin에서-비어있는-환경변수-처리\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/posts-2019-02-23-jenkins-extended-e-mail-notification-plugin에서-비어있는-환경변수-처리.json\n// module id = 408\n// module chunks = 274958555436247"],"sourceRoot":""}